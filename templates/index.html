<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FA å ±å‘Šå„ªåŒ–ç³»çµ± | Agent Skills</title>
    <link rel="stylesheet" href="/static/index.css">
</head>

<body>
    <div class="container">
        <h1>FA Report Improvement</h1>
        <p class="subtitle">åŸºæ–¼ 8D æ¨™æº–èˆ‡ LLM çš„åŠå°é«”å¤±æ•ˆåˆ†æå ±å‘Šè‡ªå‹•åŒ–å„ªåŒ–å¹³å°</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 2rem;">
            <div class="upload-area" id="ppt-zone">
                <span class="upload-icon">ğŸ“Š</span>
                <p>ä¸Šå‚³ FA å ±å‘Š (.ppt/pptx)</p>
                <button class="btn" onclick="document.getElementById('ppt-input').click()">é¸æ“‡æª”æ¡ˆ</button>
                <input type="file" id="ppt-input" hidden accept=".ppt,.pptx">
                <div id="ppt-name" class="file-name"></div>
            </div>

            <div class="upload-area" id="json-zone">
                <span class="upload-icon">ğŸ“œ</span>
                <p>ä¸Šå‚³è©•æ ¸ JSON (.json)</p>
                <button class="btn" onclick="document.getElementById('json-input').click()">é¸æ“‡æª”æ¡ˆ</button>
                <input type="file" id="json-input" hidden accept=".json">
                <div id="json-name" class="file-name"></div>
            </div>
        </div>

        <div style="text-align: center;">
            <button class="btn" id="process-btn"
                style="background: var(--primary-hover); padding: 1rem 3rem; font-size: 1.2rem;"
                disabled>é–‹å§‹å„ªåŒ–å ±å‘Š</button>
        </div>

        <div class="status-panel" id="status-panel">
            <div class="loader"></div>
            <span id="status-text">æ­£åœ¨ä¸Šå‚³å ±å‘Š...</span>
        </div>

        <div id="result-area" style="margin-top: 2rem; display: none;">
            <h3>è™•ç†å®Œæˆï¼</h3>
            <p>å ±å‘Šå·²æŒ‰ç…§ 8D æ¨™æº–å„ªåŒ–ã€‚</p>
            <a href="#" class="btn" id="download-link">ä¸‹è¼‰å„ªåŒ–å¾Œçš„å ±å‘Š</a>
        </div>
    </div>

    <script>
        const pptInput = document.getElementById('ppt-input');
        const jsonInput = document.getElementById('json-input');
        const pptName = document.getElementById('ppt-name');
        const jsonName = document.getElementById('json-name');
        const processBtn = document.getElementById('process-btn');

        const statusPanel = document.getElementById('status-panel');
        const statusText = document.getElementById('status-text');
        const resultArea = document.getElementById('result-area');
        const downloadLink = document.getElementById('download-link');

        let pptFile = null;
        let jsonFile = null;

        pptInput.addEventListener('change', (e) => {
            pptFile = e.target.files[0];
            pptName.innerText = pptFile ? `å·²é¸æ“‡ï¼š${pptFile.name}` : '';
            checkInputs();
        });

        jsonInput.addEventListener('change', (e) => {
            jsonFile = e.target.files[0];
            jsonName.innerText = jsonFile ? `å·²é¸æ“‡ï¼š${jsonFile.name}` : '';
            checkInputs();
        });

        function checkInputs() {
            processBtn.disabled = !(pptFile && jsonFile);
        }

        processBtn.addEventListener('click', async () => {
            if (!pptFile || !jsonFile) return;

            const formData = new FormData();
            formData.append('report', pptFile);
            formData.append('evaluation_json', jsonFile);

            statusPanel.classList.add('active');
            statusText.innerText = `æ­£åœ¨åˆ†æä¸¦å„ªåŒ–å ±å‘Š...`;
            resultArea.style.display = 'none';

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (response.ok) {
                    statusPanel.classList.remove('active');
                    resultArea.style.display = 'block';
                    // é€™è£¡å…ˆæš«æ™‚æŒ‡å‘ uploads ç›®éŒ„ï¼ˆéœ€åœ¨ FastAPI åŠ å…¥éœæ…‹è·¯å¾‘æˆ–ä¸‹è¼‰è·¯ç”±ï¼‰
                    downloadLink.href = `/api/download/${result.output_file}`;
                } else {
                    statusText.innerText = 'éŒ¯èª¤ï¼šä¼ºæœå™¨è™•ç†å¤±æ•—';
                }
            } catch (err) {
                statusText.innerText = 'é€£ç·šå‡ºéŒ¯';
            }
        });
    </script>
</body>

</html>