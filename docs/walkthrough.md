# 測試與驗證指南 (Walkthrough)

本指南將引導您如何測試與驗證新開發的 FA 報告優化系統。

## 1. 準備工作與啟動伺服器

### 步驟 1：配置環境變數
請確保您已建立 `.env` 檔案。若要使用 **Ollama (本地模型)**，請參考 `.env.example` 中的註釋進行設定：
```properties
# Ollama 範例
OPENAI_API_KEY=ollama
OPENAI_API_BASE=http://localhost:11434/v1
OPENAI_MODEL=llama3.1:latest
```

### 步驟 2：執行啟動指令
請確保您在專案根目錄下，使用 `uv` 啟動服務：

```powershell
# 確保依賴已同步
uv sync

# 啟動應用程式 (Port 8001)
uv run uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload
```

伺服器啟動後，請開啟瀏覽器並訪問：
[http://localhost:8001](http://localhost:8001)

## 2. 驗證步驟
## 2. UI 測試步驟

### 步驟 A：前端介面測試
1. **載入驗證**: 確認網頁是否正確顯示「FA Report Improvement」標題，且具備現代化的雙區域上傳設計。
2. **樣式檢查**: 確認是否有深色背景、紫色漸層標題以及整齊的卡片佈局。

### 模式 A：標準優化模式 (不含提示詞)
1. 在網頁左側上傳 `.pptx` 報告。
2. 在網頁右側上傳 `.json` 評核檔。
3. **保持提示詞輸入框為空。**
4. 點擊「開始優化報告」。
5. **預期結果**：系統直接呼叫技能包，產出優化報告。

### 模式 B：AI 加工優化模式 (含提示詞)
1. 同樣上傳 `.pptx` 與 `.json`。
2. 在「優化提示詞」輸入框填入具體要求，例如：
   - "請特別加強根因分析部分的數據豐富度。"
   - "調整改善對策，建議加入製程自動化監修。"
3. 點擊「開始優化報告」。
4. **預期結果**：
   - 後端會顯示 `啟動 AI 加工模式`。
   - LLM 會先修飾 JSON 內容，最後才執行優化。

## 3. API 驗證 (使用 curl)

若要直接測試整合提示詞的載入點：

```bash
curl -X POST http://localhost:8001/api/upload \
  -F "report=@your_report.pptx" \
  -F "evaluation_json=@your_eval.json" \
  -F "prompt=請加強統計分析部分的專業性"
```

## 4. 下載功能驗證
1. 待優化完成後，點擊頁面上的「下載優化後的報告」按鈕。
2. **檔名檢查**: 確認下載的檔案名稱格式為 `[原始檔名]_improved_[時間戳].pptx` (例如 `Report_improved_20240128_123055.pptx`)。

## 3. 預期結果
- 後端終端機應顯示處理進度。
- `uploads/` 資料夾中應出現原始上傳檔案與處理後的輸出檔案。
- 前端應提供正確的下載連結。

## 4. 常見問題排除
- **連接拒絕**: 檢查 8001 端口是否被佔用。
- **模組錯誤**: 確保已執行 `export PYTHONPATH=.`。

---

# 專案導覽 - v2.1.3 最終交付 (繁體中文版)

本專案已達到高度的健壯性與使用者體驗，實現了 Web UI 與底層技能包之間的全面同步。

## ✅ 重大成就 (v2.1.3)
- **極致 JSON 韌性**: 系統現在能自動修復常見的 LLM 輸出錯誤（例如結尾標點、多餘逗號、Markdown 標籤）。
- **精確錯誤反饋**: 使用者能獲得清晰、具操作性的診斷訊息，而非模糊的失敗提示。
- **智慧 UI 流程**: 前端預檢可防止錯誤上傳，同時允許後端對小瑕疵進行「智慧修復」。
- **遺留格式支援**: 自動 `.ppt` 轉 `.pptx` 轉換功能保持穩定高效。

## 🧪 最終驗證環節
我們進行了全方位的兩階段驗證：

### 1. Web UI 操作驗證
- 測試 `malformed.json` (帶有結尾點號)：伺服器成功自動修復。
- 測試 `broken.json` (語法嚴重錯誤)：UI 正確攔截並顯示詳細錯誤。
- 確認了帶有時間戳記的輸出檔案命規。

### 2. Coding Agent 操作驗證
- 直接在命令列執行 `improve_fa_report.py`。
- 使用不同模型來源（`_summary_gpt-oss120b.json` 與 `_summary_qwen3-vl-30b-a3b-instruct.json`）成功優化舊版 `.ppt` 報告。
- 確認了 Windows 環境下繁體中文輸出的編碼穩定性。

## 📁 最終狀態
- **PRD**: 已更新版本歷史與健壯性詳解。
- **README**: 強調了 v2.1.3 新增的韌性功能。
- **技能文件**: 已將所有指南的版本號統一。
- **Git**: 所有變更已提交並同步。

*專案狀態：已完成並通過驗證 (v2.1.3)* 🚀
